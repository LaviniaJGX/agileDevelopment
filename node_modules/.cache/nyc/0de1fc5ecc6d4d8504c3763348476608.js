var createError = require('http-errors');
var express = require('express');
var path = require('path');
var cookieParser = require('cookie-parser');
var logger = require('morgan');
var cors = require('cors');
const db = require('./mongodb');
var indexRouter = require('./routes/index');
var usersRouter = require('./routes/users');
// console.log('test')
const courses = require("./routes/courses");
const teacher = require("./routes/teacher");
const student = require("./routes/student");
const users = require("./routes/users");
var app = express();
// view engine setup
app.set('views', path.join(__dirname, 'views'));
app.set('view engine', 'ejs');

//app.use(logger('dev'));
app.use(express.json());
app.use(express.urlencoded({ extended: false }));
app.use(cookieParser());
app.use(express.static(path.join(__dirname, 'public')));
// cross origin
app.use(cors());
app.use('/', indexRouter);

// user Router
app.get('/user/:account', users.findByAccount);
app.post('/user', users.addUser);
// Our Courses Web App Routes
app.get('/courses', courses.findAll);
app.get('/courses/:id', courses.findById);
app.get('/coursesNumbers/numbers', courses.findTotalNumbers);
app.get('/coursesHours/hours', courses.findTotalHours);
app.get('/coursesElements/:courseTitle', courses.findByElements);

app.get('/teacher', teacher.findAll);
app.get('/teacher/:id', teacher.findById);
app.get('/teacherName/:name', teacher.findByName);
app.get('/teacherElements/:department', teacher.containNames);

app.get('/student', student.findAll);
app.get('/student/:id', student.findById);
app.get('/studentName/:name', student.findByName);
app.get('/studentElements/:name', student.containNames);

app.post('/courses', courses.addCourse);
app.post('/teacher', teacher.addTeacher);
app.post('/student', student.addStudent);

//app.put('/coursesHours/:courseTitles/:teacherName/Hour', courses.changeClassHours);
//app.put('/coursesNumbers/:courseTitles/:teacherName/StuNum', courses.changeStudentNumbers);
app.put('/coursesCertain/:id/:teacherName/CHour', courses.changeCertainHours);
app.put('/coursesCerNum/:id/:teacherName/CNum', courses.changeCertainNumbers);
app.put('/courses/:id/:teacherName/Teacher', courses.changeCertainTeacher);

app.put('/teacher/:id', teacher.changeCertainDepartment);
app.put('/teacherMajor/:id', teacher.changeCertainMajor);
app.put('/student/:id', student.changeCategory);
app.put('/studentMajor/:id', student.changeMajor);

app.delete('/courses/:id', courses.deleteCourse);
app.delete('/teacher/:id', teacher.deleteTeacherById);
app.delete('/student/:id', student.deleteStudentById);

// catch 404 and forward to error handler
app.use(function (req, res, next) {
    next(createError(404));
});

// error handler
app.use(function (err, req, res, next) {
    // set locals, only providing error in development
    res.locals.message = err.message;
    res.locals.error = req.app.get('env') === 'development' ? err : {};

    // render the error page
    res.status(err.status || 500);
    res.render('error');
});

if (app.get('env') === 'dev') {
    app.use(function (err, req, res, next) {
        res.status(err.status || 500);
        res.render('error', {
            message: err.message,
            error: err
        });
    });
}

if (process.env.NODE_ENV !== 'test') {
    app.use(logger('dev'));
}

module.exports = app;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJjcmVhdGVFcnJvciIsInJlcXVpcmUiLCJleHByZXNzIiwicGF0aCIsImNvb2tpZVBhcnNlciIsImxvZ2dlciIsImNvcnMiLCJkYiIsImluZGV4Um91dGVyIiwidXNlcnNSb3V0ZXIiLCJjb3Vyc2VzIiwidGVhY2hlciIsInN0dWRlbnQiLCJ1c2VycyIsImFwcCIsInNldCIsImpvaW4iLCJfX2Rpcm5hbWUiLCJ1c2UiLCJqc29uIiwidXJsZW5jb2RlZCIsImV4dGVuZGVkIiwic3RhdGljIiwiZ2V0IiwiZmluZEJ5QWNjb3VudCIsInBvc3QiLCJhZGRVc2VyIiwiZmluZEFsbCIsImZpbmRCeUlkIiwiZmluZFRvdGFsTnVtYmVycyIsImZpbmRUb3RhbEhvdXJzIiwiZmluZEJ5RWxlbWVudHMiLCJmaW5kQnlOYW1lIiwiY29udGFpbk5hbWVzIiwiYWRkQ291cnNlIiwiYWRkVGVhY2hlciIsImFkZFN0dWRlbnQiLCJwdXQiLCJjaGFuZ2VDZXJ0YWluSG91cnMiLCJjaGFuZ2VDZXJ0YWluTnVtYmVycyIsImNoYW5nZUNlcnRhaW5UZWFjaGVyIiwiY2hhbmdlQ2VydGFpbkRlcGFydG1lbnQiLCJjaGFuZ2VDZXJ0YWluTWFqb3IiLCJjaGFuZ2VDYXRlZ29yeSIsImNoYW5nZU1ham9yIiwiZGVsZXRlIiwiZGVsZXRlQ291cnNlIiwiZGVsZXRlVGVhY2hlckJ5SWQiLCJkZWxldGVTdHVkZW50QnlJZCIsInJlcSIsInJlcyIsIm5leHQiLCJlcnIiLCJsb2NhbHMiLCJtZXNzYWdlIiwiZXJyb3IiLCJzdGF0dXMiLCJyZW5kZXIiLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxjQUFjQyxRQUFRLGFBQVIsQ0FBbEI7QUFDQSxJQUFJQyxVQUFVRCxRQUFRLFNBQVIsQ0FBZDtBQUNBLElBQUlFLE9BQU9GLFFBQVEsTUFBUixDQUFYO0FBQ0EsSUFBSUcsZUFBZUgs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QUFtQkMsR0FBbkIsRUFBd0JDLElBQXhCLEVBQThCO0FBQ2xDRCxZQUFJTSxNQUFKLENBQVdKLElBQUlJLE1BQUosSUFBYyxHQUF6QjtBQUNBTixZQUFJTyxNQUFKLENBQVcsT0FBWCxFQUFvQjtBQUNoQkgscUJBQVNGLElBQUlFLE9BREc7QUFFaEJDLG1CQUFPSDtBQUZTLFNBQXBCO0FBSUgsS0FORDtBQU9IOztBQUVELElBQUlNLFFBQVFDLEdBQVIsQ0FBWUMsUUFBWixLQUF5QixNQUE3QixFQUFxQztBQUNqQzlDLFFBQUlJLEdBQUosQ0FBUWIsT0FBTyxLQUFQLENBQVI7QUFDSDs7QUFFRHdELE9BQU9DLE9BQVAsR0FBaUJoRCxHQUFqQiIsImZpbGUiOiJhcHAuanMiLCJzb3VyY2VSb290IjoiL1VzZXJzL2RhaWx1L0RvY3VtZW50cy9ob21ld29yay9lbmRiYWNrL2NvdXJzZXN0ZXN0Iiwic291cmNlc0NvbnRlbnQiOlsidmFyIGNyZWF0ZUVycm9yID0gcmVxdWlyZSgnaHR0cC1lcnJvcnMnKTtcbnZhciBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xudmFyIHBhdGggPSByZXF1aXJlKCdwYXRoJyk7XG52YXIgY29va2llUGFyc2VyID0gcmVxdWlyZSgnY29va2llLXBhcnNlcicpO1xudmFyIGxvZ2dlciA9IHJlcXVpcmUoJ21vcmdhbicpO1xudmFyIGNvcnMgPSByZXF1aXJlKCdjb3JzJylcbmNvbnN0IGRiID0gcmVxdWlyZSgnLi9tb25nb2RiJylcbnZhciBpbmRleFJvdXRlciA9IHJlcXVpcmUoJy4vcm91dGVzL2luZGV4Jyk7XG52YXIgdXNlcnNSb3V0ZXIgPSByZXF1aXJlKCcuL3JvdXRlcy91c2VycycpO1xuLy8gY29uc29sZS5sb2coJ3Rlc3QnKVxuY29uc3QgY291cnNlcyA9IHJlcXVpcmUoXCIuL3JvdXRlcy9jb3Vyc2VzXCIpO1xuY29uc3QgdGVhY2hlciA9IHJlcXVpcmUoXCIuL3JvdXRlcy90ZWFjaGVyXCIpO1xuY29uc3Qgc3R1ZGVudCA9IHJlcXVpcmUoXCIuL3JvdXRlcy9zdHVkZW50XCIpO1xuY29uc3QgdXNlcnMgPSByZXF1aXJlKFwiLi9yb3V0ZXMvdXNlcnNcIilcbnZhciBhcHAgPSBleHByZXNzKCk7XG4vLyB2aWV3IGVuZ2luZSBzZXR1cFxuYXBwLnNldCgndmlld3MnLCBwYXRoLmpvaW4oX19kaXJuYW1lLCAndmlld3MnKSk7XG5hcHAuc2V0KCd2aWV3IGVuZ2luZScsICdlanMnKTtcblxuLy9hcHAudXNlKGxvZ2dlcignZGV2JykpO1xuYXBwLnVzZShleHByZXNzLmpzb24oKSk7XG5hcHAudXNlKGV4cHJlc3MudXJsZW5jb2RlZCh7IGV4dGVuZGVkOiBmYWxzZSB9KSk7XG5hcHAudXNlKGNvb2tpZVBhcnNlcigpKTtcbmFwcC51c2UoZXhwcmVzcy5zdGF0aWMocGF0aC5qb2luKF9fZGlybmFtZSwgJ3B1YmxpYycpKSk7XG4vLyBjcm9zcyBvcmlnaW5cbmFwcC51c2UoY29ycygpKVxuYXBwLnVzZSgnLycsIGluZGV4Um91dGVyKTtcblxuXG5cbi8vIHVzZXIgUm91dGVyXG5hcHAuZ2V0KCcvdXNlci86YWNjb3VudCcsIHVzZXJzLmZpbmRCeUFjY291bnQpXG5hcHAucG9zdCgnL3VzZXInLCB1c2Vycy5hZGRVc2VyKVxuLy8gT3VyIENvdXJzZXMgV2ViIEFwcCBSb3V0ZXNcbmFwcC5nZXQoJy9jb3Vyc2VzJywgY291cnNlcy5maW5kQWxsKTtcbmFwcC5nZXQoJy9jb3Vyc2VzLzppZCcsIGNvdXJzZXMuZmluZEJ5SWQpO1xuYXBwLmdldCgnL2NvdXJzZXNOdW1iZXJzL251bWJlcnMnLCBjb3Vyc2VzLmZpbmRUb3RhbE51bWJlcnMpO1xuYXBwLmdldCgnL2NvdXJzZXNIb3Vycy9ob3VycycsIGNvdXJzZXMuZmluZFRvdGFsSG91cnMpO1xuYXBwLmdldCgnL2NvdXJzZXNFbGVtZW50cy86Y291cnNlVGl0bGUnLCBjb3Vyc2VzLmZpbmRCeUVsZW1lbnRzKTtcblxuYXBwLmdldCgnL3RlYWNoZXInLCB0ZWFjaGVyLmZpbmRBbGwpO1xuYXBwLmdldCgnL3RlYWNoZXIvOmlkJywgdGVhY2hlci5maW5kQnlJZCk7XG5hcHAuZ2V0KCcvdGVhY2hlck5hbWUvOm5hbWUnLCB0ZWFjaGVyLmZpbmRCeU5hbWUpO1xuYXBwLmdldCgnL3RlYWNoZXJFbGVtZW50cy86ZGVwYXJ0bWVudCcsIHRlYWNoZXIuY29udGFpbk5hbWVzKTtcblxuYXBwLmdldCgnL3N0dWRlbnQnLCBzdHVkZW50LmZpbmRBbGwpO1xuYXBwLmdldCgnL3N0dWRlbnQvOmlkJywgc3R1ZGVudC5maW5kQnlJZCk7XG5hcHAuZ2V0KCcvc3R1ZGVudE5hbWUvOm5hbWUnLCBzdHVkZW50LmZpbmRCeU5hbWUpO1xuYXBwLmdldCgnL3N0dWRlbnRFbGVtZW50cy86bmFtZScsIHN0dWRlbnQuY29udGFpbk5hbWVzKTtcblxuYXBwLnBvc3QoJy9jb3Vyc2VzJyxjb3Vyc2VzLmFkZENvdXJzZSk7XG5hcHAucG9zdCgnL3RlYWNoZXInLHRlYWNoZXIuYWRkVGVhY2hlcik7XG5hcHAucG9zdCgnL3N0dWRlbnQnLHN0dWRlbnQuYWRkU3R1ZGVudCk7XG5cbi8vYXBwLnB1dCgnL2NvdXJzZXNIb3Vycy86Y291cnNlVGl0bGVzLzp0ZWFjaGVyTmFtZS9Ib3VyJywgY291cnNlcy5jaGFuZ2VDbGFzc0hvdXJzKTtcbi8vYXBwLnB1dCgnL2NvdXJzZXNOdW1iZXJzLzpjb3Vyc2VUaXRsZXMvOnRlYWNoZXJOYW1lL1N0dU51bScsIGNvdXJzZXMuY2hhbmdlU3R1ZGVudE51bWJlcnMpO1xuYXBwLnB1dCgnL2NvdXJzZXNDZXJ0YWluLzppZC86dGVhY2hlck5hbWUvQ0hvdXInLCBjb3Vyc2VzLmNoYW5nZUNlcnRhaW5Ib3Vycyk7XG5hcHAucHV0KCcvY291cnNlc0Nlck51bS86aWQvOnRlYWNoZXJOYW1lL0NOdW0nLCBjb3Vyc2VzLmNoYW5nZUNlcnRhaW5OdW1iZXJzKTtcbmFwcC5wdXQoJy9jb3Vyc2VzLzppZC86dGVhY2hlck5hbWUvVGVhY2hlcicsIGNvdXJzZXMuY2hhbmdlQ2VydGFpblRlYWNoZXIpO1xuXG5hcHAucHV0KCcvdGVhY2hlci86aWQnLCB0ZWFjaGVyLmNoYW5nZUNlcnRhaW5EZXBhcnRtZW50KTtcbmFwcC5wdXQoJy90ZWFjaGVyTWFqb3IvOmlkJywgdGVhY2hlci5jaGFuZ2VDZXJ0YWluTWFqb3IpO1xuYXBwLnB1dCgnL3N0dWRlbnQvOmlkJywgc3R1ZGVudC5jaGFuZ2VDYXRlZ29yeSk7XG5hcHAucHV0KCcvc3R1ZGVudE1ham9yLzppZCcsIHN0dWRlbnQuY2hhbmdlTWFqb3IpO1xuXG5hcHAuZGVsZXRlKCcvY291cnNlcy86aWQnLCBjb3Vyc2VzLmRlbGV0ZUNvdXJzZSk7XG5hcHAuZGVsZXRlKCcvdGVhY2hlci86aWQnLCB0ZWFjaGVyLmRlbGV0ZVRlYWNoZXJCeUlkKTtcbmFwcC5kZWxldGUoJy9zdHVkZW50LzppZCcsIHN0dWRlbnQuZGVsZXRlU3R1ZGVudEJ5SWQpO1xuXG4vLyBjYXRjaCA0MDQgYW5kIGZvcndhcmQgdG8gZXJyb3IgaGFuZGxlclxuYXBwLnVzZShmdW5jdGlvbihyZXEsIHJlcywgbmV4dCkge1xuICAgIG5leHQoY3JlYXRlRXJyb3IoNDA0KSk7XG59KTtcblxuLy8gZXJyb3IgaGFuZGxlclxuYXBwLnVzZShmdW5jdGlvbihlcnIsIHJlcSwgcmVzLCBuZXh0KSB7XG4gICAgLy8gc2V0IGxvY2Fscywgb25seSBwcm92aWRpbmcgZXJyb3IgaW4gZGV2ZWxvcG1lbnRcbiAgICByZXMubG9jYWxzLm1lc3NhZ2UgPSBlcnIubWVzc2FnZTtcbiAgICByZXMubG9jYWxzLmVycm9yID0gcmVxLmFwcC5nZXQoJ2VudicpID09PSAnZGV2ZWxvcG1lbnQnID8gZXJyIDoge307XG5cbiAgICAvLyByZW5kZXIgdGhlIGVycm9yIHBhZ2VcbiAgICByZXMuc3RhdHVzKGVyci5zdGF0dXMgfHwgNTAwKTtcbiAgICByZXMucmVuZGVyKCdlcnJvcicpO1xufSk7XG5cbmlmIChhcHAuZ2V0KCdlbnYnKSA9PT0gJ2RldicpIHtcbiAgICBhcHAudXNlKGZ1bmN0aW9uKGVyciwgcmVxLCByZXMsIG5leHQpIHtcbiAgICAgICAgcmVzLnN0YXR1cyhlcnIuc3RhdHVzIHx8IDUwMCk7XG4gICAgICAgIHJlcy5yZW5kZXIoJ2Vycm9yJywge1xuICAgICAgICAgICAgbWVzc2FnZTogZXJyLm1lc3NhZ2UsXG4gICAgICAgICAgICBlcnJvcjogZXJyXG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuXG5pZiAocHJvY2Vzcy5lbnYuTk9ERV9FTlYgIT09ICd0ZXN0Jykge1xuICAgIGFwcC51c2UobG9nZ2VyKCdkZXYnKSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gYXBwO1xuIl19