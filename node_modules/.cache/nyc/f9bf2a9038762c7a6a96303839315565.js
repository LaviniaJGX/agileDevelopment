let express = require('express');
let router = express.Router();
var Student = require('../models/student');

//find all students
router.findAll = (req, res) => {
    // Return a JSON representation of our list
    res.setHeader('Content-Type', 'application/json');
    Student.find(function (err, students) {
        if (err) res.send(err);

        res.send(JSON.stringify(students, null, 5));
    });
};

//find certain student by id:
router.findById = (req, res) => {
    res.setHeader('Content-Type', 'application/json');
    Student.find({ "_id": req.params.id }, function (err, students) {
        if (err) {
            res.send('Student NOT Found!!');
        } else {
            res.send(JSON.stringify(students, null, 5));
        }
    });
};

//find certain student by its name;
router.findByName = (req, res) => {
    res.setHeader('Content-Type', 'application/json');
    Student.find({ "name": req.params.name }, function (err, students) {
        if (err) {
            res.send('The student you asked to find is NOT EXIST!!');
        } else {
            res.send(JSON.stringify(students, null, 5));
        }
    });
};

//find certain student which contains certain name elements;
router.containNames = (req, res) => {
    res.setHeader('Content-Type', 'application/json');
    var keyword = req.params.name;
    var reg = new RegExp(keyword, 'i');
    Student.find({ 'name': { $regex: reg } }, function (err, students) {
        if (err) {
            res.send('Student NOT Found!!');
        } else {
            res.send(JSON.stringify(students, null, 5));
        }
    });
};

//add student
router.addStudent = (req, res) => {
    res.setHeader('Content-Type', 'application/json');
    var student = new Student();

    student.name = req.body.name;
    student.studentCategory = req.body.studentCategory;
    student.coursesNumbers = req.body.coursesNumbers;
    student.major = req.body.major;

    student.save(function (err) {
        if (err) {
            res.json({ message: 'Student NOT Added!' });
        } else {

            res.json({ message: 'Student Added Successfully!', data: student });
        }
    });
};

router.changeCategory = (req, res) => {
    res.setHeader('Content-Type', 'application/json');
    var conditions = { _id: req.params.id },
        update = { studentCategory: req.body.studentCategory };
    var query = { _id: req.params.id };
    Student.update(query, { studentCategory: req.body.studentCategory }, function (err, students) {
        if (err) {
            res.status(404);
            res.json({ message: 'Student NOT Found! ', errmsg: err });
        } else {
            res.json('Category changed successfully!');
        }
    });
};

router.changeMajor = (req, res) => {
    res.setHeader('Content-Type', 'application/json');
    var conditions = { _id: req.params.id },
        update = { major: req.body.major };
    var query = { _id: req.params.id };
    Student.update(query, { major: req.body.major }, function (err, students) {
        if (err) {
            res.status(404);
            res.json({ message: 'Student NOT Found! ', errmsg: err });
        } else {
            res.json('Major changed successfully!');
        }
    });
};

//delete student by its id;
router.deleteStudentById = (req, res) => {
    Student.findByIdAndRemove(req.params.id, function (err) {
        if (err) {
            res.status(404);
            res.json({ message: 'Cant find Student, Student NOT Deleted!' });
        } else {
            res.json({ message: 'Student Deleted successfully!' });
        }
    });
};

module.exports = router;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInN0dWRlbnQuanMiXSwibmFtZXMiOlsiZXhwcmVzcyIsInJlcXVpcmUiLCJyb3V0ZXIiLCJSb3V0ZXIiLCJTdHVkZW50IiwiZmluZEFsbCIsInJlcSIsInJlcyIsInNldEhlYWRlciIsImZpbmQiLCJlcnIiLCJzdHVkZW50cyIsInNlbmQiLCJKU09OIiwic3RyaW5naWZ5IiwiZmluZEJ5SWQiLCJwYXJhbXMiLCJpZCIsImZpbmRCeU5hbWUiLCJuYW1lIiwiY29udGFpbk5hbWVzIiwia2V5d29yZCIsInJlZyIsIlJlZ0V4cCIsIiRyZWdleCIsImFkZFN0dWRlbnQiLCJzdHVkZW50IiwiYm9keSIsInN0dWRlbnRDYXRlZ29yeSIsImNvdXJzZXNOdW1iZXJzIiwibWFqb3IiLCJzYXZlIiwianNvbiIsIm1lc3NhZ2UiLCJkYXRhIiwiY2hhbmdlQ2F0ZWdvcnkiLCJjb25kaXRpb25zIiwiX2lkIiwidXBkYXRlIiwicXVlcnkiLCJzdGF0dXMiLCJlcnJtc2ciLCJjaGFuZ2VNYWpvciIsImRlbGV0ZVN0dWRlbnRCeUlkIiwiZmluZEJ5SWRBbmRSZW1vdmUiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQSxJQUFJQSxVQUFVQyxRQUFRLFNBQVIsQ0FBZDtBQUNBLElBQUlDLFNBQVNGLFFBQVFHLE1BQVIsRUFBYjtBQUNBLElBQUlDLFVBQVVILFFBQVEsbUJBQVIsQ0FBZDs7QUFFQTtBQUNBQyxPQUFPRyxPQUFQLEdBQWlCLENBQUNDLEdBQUQsRUFBTUMsR0FBTixLQUFjO0FBQzNCO0FBQ0FBLFFBQUlDLFNBQUosQ0FBYyxjQUFkLEVBQThCLGtCQUE5QjtBQUNBSixZQUFRSyxJQUFSLENBQWEsVUFBU0MsR0FBVCxFQUFjQyxRQUFkLEVBQXdCO0FBQ2pDLFlBQUlELEdBQUosRUFDSUgsSUFBSUssSUFBSixDQUFTRixHQUFUOztBQUVKSCxZQUFJSyxJQUFKLENBQVNDLEtBQUtDLFNBQUwsQ0FBZUgsUUFBZixFQUF3QixJQUF4QixFQUE2QixDQUE3QixD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eUI7QUFDcEUsWUFBSUQsR0FBSixFQUFRO0FBQ0pILGdCQUFJaUMsTUFBSixDQUFXLEdBQVg7QUFDQWpDLGdCQUFJeUIsSUFBSixDQUFTLEVBQUNDLFNBQVEscUJBQVQsRUFBZ0NRLFFBQVMvQixHQUF6QyxFQUFUO0FBQ0gsU0FIRCxNQUlLO0FBQ0RILGdCQUFJeUIsSUFBSixDQUFTLDZCQUFUO0FBQ0g7QUFDSixLQVJEO0FBU0gsQ0FiRDs7QUFnQkE7QUFDQTlCLE9BQU95QyxpQkFBUCxHQUEyQixDQUFDckMsR0FBRCxFQUFNQyxHQUFOLEtBQWM7QUFDckNILFlBQVF3QyxpQkFBUixDQUEwQnRDLElBQUlVLE1BQUosQ0FBV0MsRUFBckMsRUFBeUMsVUFBU1AsR0FBVCxFQUFjO0FBQ25ELFlBQUlBLEdBQUosRUFBUTtBQUNKSCxnQkFBSWlDLE1BQUosQ0FBVyxHQUFYO0FBQ0FqQyxnQkFBSXlCLElBQUosQ0FBUyxFQUFFQyxTQUFTLHlDQUFYLEVBQVQ7QUFDSCxTQUhELE1BSUk7QUFDQTFCLGdCQUFJeUIsSUFBSixDQUFTLEVBQUVDLFNBQVMsK0JBQVgsRUFBVDtBQUNIO0FBRUosS0FURDtBQVVILENBWEQ7O0FBYUFZLE9BQU9DLE9BQVAsR0FBaUI1QyxNQUFqQiIsImZpbGUiOiJzdHVkZW50LmpzIiwic291cmNlUm9vdCI6Ii9Vc2Vycy9kYWlsdS9Eb2N1bWVudHMvaG9tZXdvcmsvZW5kYmFjay9jb3Vyc2VzdGVzdC9yb3V0ZXMiLCJzb3VyY2VzQ29udGVudCI6WyJsZXQgZXhwcmVzcyA9IHJlcXVpcmUoJ2V4cHJlc3MnKTtcbmxldCByb3V0ZXIgPSBleHByZXNzLlJvdXRlcigpO1xudmFyIFN0dWRlbnQgPSByZXF1aXJlKCcuLi9tb2RlbHMvc3R1ZGVudCcpO1xuXG4vL2ZpbmQgYWxsIHN0dWRlbnRzXG5yb3V0ZXIuZmluZEFsbCA9IChyZXEsIHJlcykgPT4ge1xuICAgIC8vIFJldHVybiBhIEpTT04gcmVwcmVzZW50YXRpb24gb2Ygb3VyIGxpc3RcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIFN0dWRlbnQuZmluZChmdW5jdGlvbihlcnIsIHN0dWRlbnRzKSB7XG4gICAgICAgIGlmIChlcnIpXG4gICAgICAgICAgICByZXMuc2VuZChlcnIpO1xuXG4gICAgICAgIHJlcy5zZW5kKEpTT04uc3RyaW5naWZ5KHN0dWRlbnRzLG51bGwsNSkpO1xuICAgIH0pO1xufVxuXG4vL2ZpbmQgY2VydGFpbiBzdHVkZW50IGJ5IGlkOlxucm91dGVyLmZpbmRCeUlkID0gKHJlcSwgcmVzKSA9PiB7XG4gICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICBTdHVkZW50LmZpbmQoeyBcIl9pZFwiIDogcmVxLnBhcmFtcy5pZCB9LGZ1bmN0aW9uKGVyciwgc3R1ZGVudHMpIHtcbiAgICAgICAgaWYgKGVycil7XG4gICAgICAgICAgICByZXMuc2VuZCgnU3R1ZGVudCBOT1QgRm91bmQhIScpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeShzdHVkZW50cyxudWxsLDUpKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG4vL2ZpbmQgY2VydGFpbiBzdHVkZW50IGJ5IGl0cyBuYW1lO1xucm91dGVyLmZpbmRCeU5hbWUgPSAocmVxLCByZXMpID0+IHtcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIFN0dWRlbnQuZmluZCh7IFwibmFtZVwiIDogcmVxLnBhcmFtcy5uYW1lIH0sZnVuY3Rpb24oZXJyLCBzdHVkZW50cykge1xuICAgICAgICBpZiAoZXJyKXtcbiAgICAgICAgICAgIHJlcy5zZW5kKCdUaGUgc3R1ZGVudCB5b3UgYXNrZWQgdG8gZmluZCBpcyBOT1QgRVhJU1QhIScpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeShzdHVkZW50cyxudWxsLDUpKTtcbiAgICAgICAgfVxuICAgIH0pO1xufTtcblxuLy9maW5kIGNlcnRhaW4gc3R1ZGVudCB3aGljaCBjb250YWlucyBjZXJ0YWluIG5hbWUgZWxlbWVudHM7XG5yb3V0ZXIuY29udGFpbk5hbWVzID0gKHJlcSwgcmVzKSA9PntcbiAgICByZXMuc2V0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24vanNvbicpO1xuICAgIHZhciBrZXl3b3JkID0gcmVxLnBhcmFtcy5uYW1lO1xuICAgIHZhciByZWc9bmV3IFJlZ0V4cChrZXl3b3JkLCdpJyk7XG4gICAgU3R1ZGVudC5maW5kKHsnbmFtZSc6eyRyZWdleDogcmVnfSB9LGZ1bmN0aW9uKGVyciwgc3R1ZGVudHMpIHtcbiAgICAgICAgaWYgKGVycil7XG4gICAgICAgICAgICByZXMuc2VuZCgnU3R1ZGVudCBOT1QgRm91bmQhIScpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICByZXMuc2VuZChKU09OLnN0cmluZ2lmeShzdHVkZW50cyxudWxsLDUpKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuXG5cbi8vYWRkIHN0dWRlbnRcbnJvdXRlci5hZGRTdHVkZW50ID0gKHJlcSwgcmVzKSA9PiB7XG4gICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICB2YXIgc3R1ZGVudCA9IG5ldyBTdHVkZW50KCk7XG5cbiAgICBzdHVkZW50Lm5hbWUgPSAgcmVxLmJvZHkubmFtZTtcbiAgICBzdHVkZW50LnN0dWRlbnRDYXRlZ29yeSA9IHJlcS5ib2R5LnN0dWRlbnRDYXRlZ29yeTtcbiAgICBzdHVkZW50LmNvdXJzZXNOdW1iZXJzID0gcmVxLmJvZHkuY291cnNlc051bWJlcnM7XG4gICAgc3R1ZGVudC5tYWpvciA9IHJlcS5ib2R5Lm1ham9yO1xuXG4gICAgc3R1ZGVudC5zYXZlKGZ1bmN0aW9uKGVycikge1xuICAgICAgICBpZiAoZXJyKXtcbiAgICAgICAgICAgIHJlcy5qc29uKHsgbWVzc2FnZTogJ1N0dWRlbnQgTk9UIEFkZGVkISd9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNle1xuXG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdTdHVkZW50IEFkZGVkIFN1Y2Nlc3NmdWxseSEnLGRhdGE6c3R1ZGVudH0pO1xuICAgICAgICB9XG4gICAgfSk7XG5cbn1cblxucm91dGVyLmNoYW5nZUNhdGVnb3J5ID0ocmVxLHJlcykgPT4ge1xuICAgIHJlcy5zZXRIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uJyk7XG4gICAgdmFyIGNvbmRpdGlvbnMgPSB7IF9pZDogcmVxLnBhcmFtcy5pZCB9ICwgdXBkYXRlID0geyAgc3R1ZGVudENhdGVnb3J5OiByZXEuYm9keS5zdHVkZW50Q2F0ZWdvcnkgfTtcbiAgICB2YXIgcXVlcnkgPSB7IF9pZDogcmVxLnBhcmFtcy5pZCB9O1xuICAgIFN0dWRlbnQudXBkYXRlKHF1ZXJ5LCB7IHN0dWRlbnRDYXRlZ29yeTogcmVxLmJvZHkuc3R1ZGVudENhdGVnb3J5fSxmdW5jdGlvbiAoZXJyLCBzdHVkZW50cykge1xuICAgICAgICBpZiAoZXJyKXtcbiAgICAgICAgICAgIHJlcy5zdGF0dXMoNDA0KTtcbiAgICAgICAgICAgIHJlcy5qc29uKHttZXNzYWdlOidTdHVkZW50IE5PVCBGb3VuZCEgJywgZXJybXNnIDogZXJyfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXMuanNvbignQ2F0ZWdvcnkgY2hhbmdlZCBzdWNjZXNzZnVsbHkhJyk7XG4gICAgICAgIH1cbiAgICB9KVxufVxuXG5yb3V0ZXIuY2hhbmdlTWFqb3IgPShyZXEscmVzKSA9PiB7XG4gICAgcmVzLnNldEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb24nKTtcbiAgICB2YXIgY29uZGl0aW9ucyA9IHsgX2lkOiByZXEucGFyYW1zLmlkIH0gLCB1cGRhdGUgPSB7ICBtYWpvcjogcmVxLmJvZHkubWFqb3IgfTtcbiAgICB2YXIgcXVlcnkgPSB7IF9pZDogcmVxLnBhcmFtcy5pZCB9O1xuICAgIFN0dWRlbnQudXBkYXRlKHF1ZXJ5LCB7IG1ham9yOiByZXEuYm9keS5tYWpvcn0sZnVuY3Rpb24gKGVyciwgc3R1ZGVudHMpIHtcbiAgICAgICAgaWYgKGVycil7XG4gICAgICAgICAgICByZXMuc3RhdHVzKDQwNCk7XG4gICAgICAgICAgICByZXMuanNvbih7bWVzc2FnZTonU3R1ZGVudCBOT1QgRm91bmQhICcsIGVycm1zZyA6IGVycn0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzLmpzb24oJ01ham9yIGNoYW5nZWQgc3VjY2Vzc2Z1bGx5IScpO1xuICAgICAgICB9XG4gICAgfSlcbn1cblxuXG4vL2RlbGV0ZSBzdHVkZW50IGJ5IGl0cyBpZDtcbnJvdXRlci5kZWxldGVTdHVkZW50QnlJZCA9IChyZXEsIHJlcykgPT4ge1xuICAgIFN0dWRlbnQuZmluZEJ5SWRBbmRSZW1vdmUocmVxLnBhcmFtcy5pZCwgZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgIGlmIChlcnIpe1xuICAgICAgICAgICAgcmVzLnN0YXR1cyg0MDQpO1xuICAgICAgICAgICAgcmVzLmpzb24oeyBtZXNzYWdlOiAnQ2FudCBmaW5kIFN0dWRlbnQsIFN0dWRlbnQgTk9UIERlbGV0ZWQhJ30pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2V7XG4gICAgICAgICAgICByZXMuanNvbih7IG1lc3NhZ2U6ICdTdHVkZW50IERlbGV0ZWQgc3VjY2Vzc2Z1bGx5ISd9KTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gcm91dGVyOyJdfQ==